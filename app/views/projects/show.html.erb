<%= render "shared/lancelot_nav" %>
<div class="container project-show">

  <div class="project-details">
    <h1 class="project-title"><%= @project.name %></h1>
    <p class="project-description"><%= @project.aim %></p>
    <p class="project-hourly-rate">Hourly Rate: £<%= format('%.2f', @project.hourly_rate) %>/hour</p>
    <p class="project-status">
      Status: <%= @project.completed ? "Completed" : "In Progress" %>
    </p>
    <div class="project-btns d-flex justify-content-between">
        <!-- ✅ Project Completion Section (NEW) -->

        <%= link_to 'Edit Project', edit_client_project_path(@client, @project), class: 'btn-medieval' %>
        <% if @project.completed? %>
          <p class="text-success"><strong>✅ Project Completed</strong></p>
        <% else %>
          <%= button_to "Mark as Completed", complete_client_project_path(@client, @project), method: :patch, class: "btn-medieval" %>
        <% end %>


      <!-- Archive/Restore Buttons -->

      <% if @project.archived? %>
        <%= button_to "Restore Project", restore_client_project_path(@client, @project), method: :patch, class: "btn-medieval" %>
      <% else %>
        <%= button_to "Archive", archive_client_project_path(@client, @project), method: :patch, class: "btn-medieval" %>
      <% end %>


    </div>
    <% unless defined?(@project) && @project == @project %>
      <% if defined?(@client) && @client.present? %>
        <%= link_to 'View Project', client_project_path(@client, project), class: 'btn-medieval' %>
      <% else %>
        <% client = project.client %>
        <%= link_to 'View Project', client_project_path(client, project), class: 'btn-medieval' %>
      <% end %>
    <% end %>
  </div>

  <% if @project.timesheets.any? %>
    <div class="project-timesheet-index card">
      <div class="card-header">
        <h3>Timesheets</h3>
      </div>
      <ul class="list-group list-group-flush">
        <% @project.timesheets.each do |timesheet| %>
        <li class="list-group-item">
          <%= link_to client_project_timesheet_path(@client, @project, timesheet) do %>
            <strong><%= "#{timesheet.title} | Current Total: £#{timesheet.total}" %></strong>
          <% end %>
        </li>
        <% end %>
      </ul>
    </div>

  <% else %>
    <p>No timesheets available for this project.</p>
  <% end %>

  <!-- Adding new timesheet button -->
  <%= simple_form_for [@client, @project, @timesheet] do |f| %>
    <%= f.submit 'New timesheet', class: 'btn-medieval' %>
  <% end %>




  <% if @project.timesheets.present? %>
    <%= render "timestamps/start_button", timesheet: @project.timesheets.last, timestamp: @timestamp %>
  <% end %>
  <%= link_to "Return to #{@client.name} projects", client_projects_path(@client), class: 'blue-button' %>

</div>
